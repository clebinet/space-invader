<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Space Invaders Triangles</title>
<style>
  body { margin: 0; overflow: hidden; background: black; }
  canvas { display: block; margin: 0 auto; background: black; }
  #shootBtn, #shopBtn, #pauseBtn, #restartBtn {
    position: absolute; padding: 10px; border-radius: 8px;
    background: grey; color: white; font-weight: bold; user-select: none;
  }
  #shootBtn { right: 20px; bottom: 120px; width: 100px; height: 60px; }
  #shopBtn { left: 50%; transform: translateX(-50%); bottom: 120px; width: 120px; height: 40px; }
  #pauseBtn { left: 50%; transform: translateX(-50%); bottom: 60px; width: 120px; height: 40px; }
  #restartBtn { left: 50%; transform: translateX(-50%); top: 50%; display:none; width: 140px; height: 50px; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<button id="shootBtn">TIR</button>
<button id="shopBtn">SHOP</button>
<button id="pauseBtn">PAUSE</button>
<button id="restartBtn">RECOMMENCER</button>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const WIDTH = canvas.width;
const HEIGHT = canvas.height;

// --- Player ---
let player = {x: WIDTH/2, y: HEIGHT-60, size: 15, speed: 5, lives: 3};

// --- Game ---
let bullets = [];
let enemies = [];
let specialEnemies = [];
let score = 0;
let spaceCoins = parseInt(localStorage.getItem('spaceCoins')) || 0;
let shopOpen = false;
let paused = false;
let gameOver = false;

  // === Console Cheats ===
window.gameVars = {
    // SpaceCoins
    spaceCoins: () => spaceCoins,
    setSpaceCoins: (val) => { spaceCoins = val; saveSpaceCoins(); },

    // Score
    score: () => score,
    setScore: (val) => { score = val; },

    // Vies
    lives: () => lives,
    setLives: (val) => { lives = val; },

    // Invulnérabilité temporaire
    invulnerable: () => invulnerable,
    setInvulnerable: (val) => { invulnerable = val; },

    // Invulnérabilité infinie (mode triche)
    infiniteInvuln: () => infiniteInvuln,
    setInfiniteInvuln: (val) => { infiniteInvuln = val; },
};


// --- Fire delay ---
let lastShotTime = 0;
const fireDelay = 300; // ms

// --- Controls ---
let keys = {left:false,right:false,space:false};

// --- Shop ---
const shopItems = [
  {name:"Speed x2", cost:10000, bought:false},
  {name:"Invuln 1min", cost:20000, bought:false}
];
let shopMessage = "";
let shopMessageTimer = 0;

// --- Enemy spawn ---
setInterval(()=>{
  if(!paused && !shopOpen && !gameOver){
    const speed = 1 + Math.random()*2;
    enemies.push({x: Math.random()*(WIDTH-30)+15, y:0, speed:speed});
  }
},50); // 100 ms

// --- Special Enemy spawn ---
setInterval(()=>{
  if(!paused && !shopOpen && !gameOver){
    specialEnemies.push({x: Math.random()*(WIDTH-30)+15, y:0, speed:1.5});
  }
},900000); // 15 minutes

// --- Input ---
document.addEventListener('keydown', e=>{
  if(e.key==="ArrowLeft") keys.left=true;
  if(e.key==="ArrowRight") keys.right=true;
  if(e.key===" ") keys.space=true;
});
document.addEventListener('keyup', e=>{
  if(e.key==="ArrowLeft") keys.left=false;
  if(e.key==="ArrowRight") keys.right=false;
  if(e.key===" ") keys.space=false;
});

// --- Touch buttons ---
document.getElementById('shootBtn').addEventListener('click', shoot);
document.getElementById('shopBtn').addEventListener('click', ()=>{
  shopOpen=!shopOpen;
});
document.getElementById('pauseBtn').addEventListener('click', ()=>{
  paused=!paused;
});
document.getElementById('restartBtn').addEventListener('click', ()=>{
  restartGame();
  document.getElementById('restartBtn').style.display='none';
});

// --- Shoot ---
function shoot(){
  const now = Date.now();
  if(now - lastShotTime < fireDelay) return;
  bullets.push({x:player.x, y:player.y - player.size, speed:7});
  lastShotTime = now;
}

// --- Restart ---
function restartGame(){
  player.lives=3;
  player.x=WIDTH/2;
  player.y=HEIGHT-60;
  bullets=[];
  enemies=[];
  specialEnemies=[];
  score=0;
  gameOver=false;
}

// --- Game loop ---
function loop(){
  ctx.clearRect(0,0,WIDTH,HEIGHT);

  if(!paused && !shopOpen && !gameOver){
    // --- Player movement ---
    if(keys.left && player.x-player.size>0) player.x-=player.speed;
    if(keys.right && player.x+player.size<WIDTH) player.x+=player.speed;
    if(keys.space) shoot();

    // --- Draw player ---
    ctx.fillStyle="white";
    ctx.beginPath();
    ctx.moveTo(player.x, player.y - player.size);
    ctx.lineTo(player.x - player.size, player.y + player.size);
    ctx.lineTo(player.x + player.size, player.y + player.size);
    ctx.closePath();
    ctx.fill();

    // --- Bullets ---
    bullets.forEach((b,i)=>{
      b.y -= b.speed;
      ctx.fillStyle="green";
      ctx.beginPath();
      ctx.arc(b.x,b.y,5,0,Math.PI*2);
      ctx.fill();
      if(b.y<0) bullets.splice(i,1);
    });

    // --- Enemies ---
    enemies.forEach((e,i)=>{
      e.y+=e.speed;
      ctx.fillStyle="red";
      ctx.beginPath();
      ctx.moveTo(e.x,e.y-15);
      ctx.lineTo(e.x-15,e.y+15);
      ctx.lineTo(e.x+15,e.y+15);
      ctx.closePath();
      ctx.fill();
      // Collision avec player
      if(Math.abs(e.x-player.x)<20 && Math.abs(e.y-player.y)<20){
        player.lives--;
        enemies.splice(i,1);
        if(player.lives<=0) gameOver=true;
      }
      // Collision avec bullets
      bullets.forEach((b,j)=>{
        if(Math.abs(b.x-e.x)<20 && Math.abs(b.y-e.y)<20){
          bullets.splice(j,1);
          enemies.splice(i,1);
          score+=10;
          spaceCoins+=1;
          localStorage.setItem('spaceCoins',spaceCoins);
        }
      });
    });

    // --- Special Enemies ---
    specialEnemies.forEach((se,i)=>{
      se.y+=se.speed;
      ctx.fillStyle="gold";
      ctx.beginPath();
      ctx.moveTo(se.x,se.y-15);
      ctx.lineTo(se.x-15,se.y+15);
      ctx.lineTo(se.x+15,se.y+15);
      ctx.closePath();
      ctx.fill();
      bullets.forEach((b,j)=>{
        if(Math.abs(b.x-se.x)<20 && Math.abs(b.y-se.y)<20){
          bullets.splice(j,1);
          specialEnemies.splice(i,1);
          score+=50;
          spaceCoins+=2; // x2
          localStorage.setItem('spaceCoins',spaceCoins);
        }
      });
    });

    // --- HUD ---
    ctx.fillStyle="white";
    ctx.font="20px Arial";
    ctx.fillText(`Score: ${score}`,10,30);
    ctx.fillText(`SpaceCoins: ${spaceCoins}`,10,60);
    ctx.fillText(`Vies: ${player.lives}`,10,90);

  } else if(shopOpen){
    // --- Shop UI ---
    ctx.fillStyle="purple";
    ctx.fillRect(0,0,WIDTH,HEIGHT);
    ctx.fillStyle="white";
    ctx.font="30px Arial";
    ctx.fillText("=== SHOP SPACECOINS ===", WIDTH/2-200, 50);
    shopItems.forEach((item,i)=>{
      ctx.fillStyle="grey";
      ctx.fillRect(200,150+i*60,300,40);
      ctx.fillStyle="white";
      ctx.fillText(`${item.name} (${item.cost} SC)`, 210,180+i*60);
      // Click detection
      canvas.addEventListener('click', function shopClick(evt){
        const rect = canvas.getBoundingClientRect();
        const mx = evt.clientX - rect.left;
        const my = evt.clientY - rect.top;
        if(mx>200 && mx<500 && my>150+i*60 && my<190+i*60){
          if(spaceCoins>=item.cost){
            spaceCoins-=item.cost;
            localStorage.setItem('spaceCoins',spaceCoins);
            shopMessage = `${item.name} acheté !`;
          } else {
            shopMessage = "Pas assez de SpaceCoins !";
          }
          shopMessageTimer=Date.now()+1500;
        }
      });
    });
    if(shopMessage && Date.now()<shopMessageTimer){
      ctx.fillStyle="red";
      ctx.fillText(shopMessage,200,400);
    }
  }

  // --- Game Over ---
  if(gameOver){
    ctx.fillStyle="red";
    ctx.font="40px Arial";
    ctx.fillText("GAME OVER", WIDTH/2-120, HEIGHT/2-50);
    document.getElementById('restartBtn').style.display='block';
  }

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>





